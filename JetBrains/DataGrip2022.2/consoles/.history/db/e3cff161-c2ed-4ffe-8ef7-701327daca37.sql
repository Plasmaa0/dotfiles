INSERT INTO sellers (name)
VALUES
  ('Hall Guerra'),
  ('Nicholas Gillespie'),
  ('Orson Scott'),
  ('Jacqueline Hooper'),
  ('Ulysses Becker'),
  ('Chase Keith'),
  ('Pamela Atkins'),
  ('Lillith Shepherd'),
  ('Porter Short'),
  ('Malachi Prince');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Joshua Fuller'),
  ('Amanda Ramsey'),
  ('Griffith Mckinney'),
  ('Idola Mann'),
  ('Cole Bryan'),
  ('Christen English'),
  ('Belle Sutton'),
  ('Brooke Scott'),
  ('Dale Walters'),
  ('Felix York');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Petra Hyde'),
  ('Valentine Hurst'),
  ('Quyn Ray'),
  ('Macaulay Logan'),
  ('Ashely Zamora'),
  ('Arden Berry'),
  ('Ima Whitley'),
  ('Neil Mathis'),
  ('Samantha Gordon'),
  ('Marcia Waters');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Ava Patton'),
  ('Kuame Meyers'),
  ('Otto Andrews'),
  ('Christopher Wyatt'),
  ('Odysseus Lewis'),
  ('Tasha Kennedy'),
  ('Guinevere Koch'),
  ('Donovan Freeman'),
  ('Brielle Osborne'),
  ('Cadman Mills');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Tad Olsen'),
  ('Hoyt Frazier'),
  ('Matthew Ortiz'),
  ('Cora Bird'),
  ('Natalie Stein'),
  ('Allegra Martinez'),
  ('Francis Thomas'),
  ('Hop Potter'),
  ('Nicholas Logan'),
  ('Bo Garza');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Hayes Cummings'),
  ('Orson Woodard'),
  ('Wylie England'),
  ('Martina Barber'),
  ('Ocean Sloan'),
  ('Kelly Albert'),
  ('Patrick Mcconnell'),
  ('Lyle Smith'),
  ('Charity Cherry'),
  ('Selma Thornton');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Lois Merritt'),
  ('Clayton Benjamin'),
  ('Chiquita Battle'),
  ('Donna Davidson'),
  ('Maris Robinson'),
  ('Kenneth Rosario'),
  ('Jerry Benton'),
  ('Sean French'),
  ('Celeste Soto'),
  ('Sonya Stafford');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Vance Bush'),
  ('Adrian Black'),
  ('Sasha Rodriquez'),
  ('Fulton Mercer'),
  ('Gisela Franco'),
  ('Aimee Ewing'),
  ('Ora Schultz'),
  ('Catherine Grimes'),
  ('Aidan Cantrell'),
  ('Fiona Vincent');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Driscoll Herring'),
  ('Keegan Miller'),
  ('Reuben Downs'),
  ('Byron Short'),
  ('Reagan Duffy'),
  ('Winter King'),
  ('Quamar Whitehead'),
  ('Clio Weaver'),
  ('Alexandra Brady'),
  ('Wyatt Jimenez');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Abigail Gross'),
  ('Gabriel Hill'),
  ('Hunter Davis'),
  ('Jenette Kinney'),
  ('Vincent Murphy'),
  ('Montana Knapp'),
  ('Carol King'),
  ('Ursula Lang'),
  ('Timothy Bernard'),
  ('Tanisha Tucker');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO sellers (name)
VALUES
  ('Imelda George'),
  ('Quinn Cunningham'),
  ('Ursa Pena'),
  ('Idola Moore'),
  ('Camilla Raymond'),
  ('Jaquelyn Nolan'),
  ('Ivor Williamson'),
  ('Yuli Skinner'),
  ('Calista Dennis'),
  ('Valentine Baxter');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Summer Marks'),
  ('Tate Lindsey'),
  ('Selma Morrow'),
  ('Berk Wade'),
  ('Whitney Spencer'),
  ('Zephania Garrison'),
  ('Adara Roman'),
  ('Benjamin Jarvis'),
  ('Darrel Cummings'),
  ('Anastasia Nielsen');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Reece Maddox'),
  ('Kirk Cameron'),
  ('Nathaniel Finch'),
  ('Rudyard Bartlett'),
  ('Alexa Sweeney'),
  ('Ginger Andrews'),
  ('Doris Rowe'),
  ('Benedict Patton'),
  ('Shaeleigh Berger'),
  ('Donovan Strong');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Tamekah Browning'),
  ('Ezra Bright'),
  ('Holmes Campbell'),
  ('Leandra Lott'),
  ('Joseph Freeman'),
  ('Kasper Mccall'),
  ('Grant Mercer'),
  ('Lucas Doyle'),
  ('Aileen Orr'),
  ('Boris Perkins');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Zenia O''brien'),
  ('Serina House'),
  ('Allistair Madden'),
  ('Marvin Montgomery'),
  ('Hedley Weiss'),
  ('Heather Blankenship'),
  ('Rachel Ramirez'),
  ('Amaya Blanchard'),
  ('Bruce Potts'),
  ('Gisela Fisher');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Lani Mercer'),
  ('Demetria Juarez'),
  ('Quon Patrick'),
  ('Beau Clements'),
  ('Angelica Hyde'),
  ('Olga Moran'),
  ('Zenia Wallace'),
  ('Leonard Herman'),
  ('Dominic Huffman'),
  ('Gannon Sykes');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Ebony Kramer'),
  ('Owen Burris'),
  ('Samson Barrett'),
  ('Candace Acevedo'),
  ('Felix Hughes'),
  ('Cain Singleton'),
  ('Buckminster Kane'),
  ('Charde Whitney'),
  ('Tamekah Lang'),
  ('Wade Cannon');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Leroy Stuart'),
  ('Flavia Pace'),
  ('Jamalia Brooks'),
  ('Jorden Pennington'),
  ('Hedley Morin'),
  ('Jamal Vazquez'),
  ('Francesca Kelly'),
  ('Clio Bowman'),
  ('Ethan Harmon'),
  ('Nyssa Estrada');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Dillon Parsons'),
  ('Isabella Pugh'),
  ('Rhea Rhodes'),
  ('Dora Hicks'),
  ('Kelly Suarez'),
  ('Sopoline Coleman'),
  ('Gareth Slater'),
  ('Chantale French'),
  ('Travis Carr'),
  ('Wanda Alford');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Sean Patterson'),
  ('Calvin Patrick'),
  ('Sybil Cleveland'),
  ('Sara Wynn'),
  ('Roanna Carr'),
  ('Jenna Reynolds'),
  ('Dominique Shaw'),
  ('Marny Prince'),
  ('Jaden Bates'),
  ('Zelenia Fisher');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Hamish Shepard'),
  ('Nell Love'),
  ('Philip Sanders'),
  ('Xenos Phillips'),
  ('Dorothy Herman'),
  ('Quinn Mercado'),
  ('Jeremy Willis'),
  ('Scott Quinn'),
  ('Caryn Hurst'),
  ('Olivia Mills');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Herrod Willis'),
  ('Kelly Barber'),
  ('Allegra Townsend'),
  ('Judith Padilla'),
  ('Fletcher Chan'),
  ('Whitney Johns'),
  ('Mannix Harper'),
  ('Igor Clements'),
  ('Charissa Hanson'),
  ('Jared Tanner');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Aimee Larsen'),
  ('Daniel Reeves'),
  ('Zenaida Watson'),
  ('Karly Griffin'),
  ('Wang Morton'),
  ('Stella Jacobs'),
  ('Lev Brennan'),
  ('Gavin Jensen'),
  ('Victor Rodriquez'),
  ('Shelby Bradford');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Britanni Nieves'),
  ('Yvette Faulkner'),
  ('Jared Pope'),
  ('Dacey Newton'),
  ('Zane Lane'),
  ('Cailin Guerrero'),
  ('Leslie Pollard'),
  ('Tatiana Conley'),
  ('Ethan Pennington'),
  ('Francesca Horton');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Caesar Ferguson'),
  ('Jemima Patterson'),
  ('Tatiana David'),
  ('Jenna Rice'),
  ('Deborah Velasquez'),
  ('Cedric Mclean'),
  ('Aphrodite Wright'),
  ('Kelsey Kane'),
  ('Nell Cotton'),
  ('Palmer Goff');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Emma Campbell'),
  ('Joelle Hinton'),
  ('Bruce Rice'),
  ('Alvin Terrell'),
  ('Solomon Sexton'),
  ('Mari Nixon'),
  ('Wynter Simmons'),
  ('Perry York'),
  ('Kenyon Vaughn'),
  ('Kyle Melendez');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Shaeleigh Guthrie'),
  ('Daphne Barr'),
  ('Beatrice Gentry'),
  ('Joel Noel'),
  ('Julian Fry'),
  ('Grace Dickson'),
  ('Raphael Key'),
  ('Kay Calderon'),
  ('Elton Woodward'),
  ('Quintessa Moore');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Keaton Huffman'),
  ('Yvette Dean'),
  ('Lucius French'),
  ('Myra Duncan'),
  ('Richard Berg'),
  ('Glenna Wagner'),
  ('Kalia Pennington'),
  ('Carter Burris'),
  ('Callie Cook'),
  ('Iris Waters');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Silas Luna'),
  ('Angelica Shepard'),
  ('Yoko Merritt'),
  ('Ivana Sweeney'),
  ('Lewis Lyons'),
  ('Carly Henderson'),
  ('Kirsten Gross'),
  ('Wendy Hendrix'),
  ('Briar Gibbs'),
  ('Nevada Johns');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Cassady Blankenship'),
  ('Cameron Meyers'),
  ('Jakeem Meyers'),
  ('MacKenzie Flynn'),
  ('Carson Bass'),
  ('Rowan Ayers'),
  ('Aphrodite Berger'),
  ('Keith Salinas'),
  ('Kay Maynard'),
  ('Holmes Dunn');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Aladdin Dawson'),
  ('Olympia Kerr'),
  ('Mia Montgomery'),
  ('Oscar Davenport'),
  ('Maris Rose'),
  ('Kenyon Harrell'),
  ('Charles Kerr'),
  ('Darryl Haley'),
  ('Wyatt Singleton'),
  ('Carly Stein');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Brock Holmes'),
  ('Jonas Reid'),
  ('Chandler Sexton'),
  ('Harper Carroll'),
  ('Baxter Mccray'),
  ('Vaughan Webster'),
  ('Jamal Maddox'),
  ('Omar Sanders'),
  ('Logan Craft'),
  ('Chester Washington');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Kevyn Whitley'),
  ('Ulric Henson'),
  ('Ivy Farley'),
  ('Tyler Ewing'),
  ('Castor Casey'),
  ('Reuben Brooks'),
  ('Mercedes Pickett'),
  ('Brent Todd'),
  ('Rhonda Moses'),
  ('Ima Gardner');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Finn Christian'),
  ('Jesse Lawson'),
  ('Fiona Burgess'),
  ('Gage Fry'),
  ('Macey Trujillo'),
  ('Dominic Rivas'),
  ('Jordan Henderson'),
  ('Holmes Blankenship'),
  ('Rahim West'),
  ('Keelie Nicholson');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Gillian Harper'),
  ('Hilary Tyler'),
  ('Claire Mercer'),
  ('Bruno Montgomery'),
  ('Hayfa Sanford'),
  ('Jason Maynard'),
  ('Arden Wilkinson'),
  ('Felix Barrett'),
  ('Colorado Dale'),
  ('Mohammad Huffman');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Holmes Holland'),
  ('Olga Lott'),
  ('Nigel Acevedo'),
  ('Len Levine'),
  ('Oliver Parsons'),
  ('Debra Walters'),
  ('Clark Hernandez'),
  ('Melvin Haley'),
  ('Nehru Rodriguez'),
  ('Candace Hudson');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Kylie Wilkerson'),
  ('Ivan Foley'),
  ('Zachery Gaines'),
  ('Kirby Hubbard'),
  ('Inez Wade'),
  ('Gary Gutierrez'),
  ('Nigel Hood'),
  ('Dieter Moody'),
  ('Randall Wilder'),
  ('Ivor Hurley');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Maris Craig'),
  ('Jelani Burt'),
  ('Ahmed Ferguson'),
  ('Yvonne Finch'),
  ('Alec Sears'),
  ('Jocelyn Sargent'),
  ('Blaze James'),
  ('Mason Charles'),
  ('Brielle Hurley'),
  ('Selma Tillman');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Lydia Johnson'),
  ('Jemima Miller'),
  ('Kelly Merritt'),
  ('Joelle Ballard'),
  ('Whoopi Chan'),
  ('Emery Ayers'),
  ('Herrod Franks'),
  ('Hedley Buck'),
  ('Jorden Reynolds'),
  ('Quinlan Payne');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Tana Barlow'),
  ('Quinlan Compton'),
  ('Martha Heath'),
  ('Quon Petersen'),
  ('Yoshi Merritt'),
  ('Cairo Ferrell'),
  ('Chase Bauer'),
  ('Ezekiel Glass'),
  ('Patricia Riggs'),
  ('Armand Aguilar');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Zeph Mccray'),
  ('Shea Mcleod'),
  ('Jaquelyn Delacruz'),
  ('Channing Perez'),
  ('Kimberly Sears'),
  ('Clarke Hampton'),
  ('Carolyn Farmer'),
  ('Salvador Dennis'),
  ('Adara Mcgowan'),
  ('Rigel Harper');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Scarlet Cunningham'),
  ('Merrill Boone'),
  ('Hayes Dean'),
  ('Jemima Ball'),
  ('Marvin Robles'),
  ('Aristotle Edwards'),
  ('Aspen Good'),
  ('Charlotte Rivers'),
  ('David Greene'),
  ('Constance Alston');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Bertha Tillman'),
  ('Willa Phelps'),
  ('Len Lee'),
  ('Piper Gay'),
  ('Claire Ratliff'),
  ('Vance Jennings'),
  ('Macon Cobb'),
  ('Chadwick Berg'),
  ('August Gallegos'),
  ('Beck Ayala');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Hedley Campos'),
  ('Shay Padilla'),
  ('Kyla Montoya'),
  ('Nasim Hopper'),
  ('Finn Copeland'),
  ('Ivy Johnston'),
  ('Ferdinand Case'),
  ('Hasad Kerr'),
  ('Lyle Macias'),
  ('Sade Levine');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Stewart Keller'),
  ('Joel Hartman'),
  ('Richard Levine'),
  ('Chandler Roy'),
  ('Neville Rich'),
  ('Blythe Lott'),
  ('Hunter Stout'),
  ('Alvin Wilkins'),
  ('Odette Hale'),
  ('Darryl Delacruz');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Ralph Wong'),
  ('Stella Strong'),
  ('Teagan Kim'),
  ('Zelenia Hancock'),
  ('Louis Smith'),
  ('Linda Mcconnell'),
  ('Debra Spencer'),
  ('Elliott Cooper'),
  ('Buffy Ayers'),
  ('Hayley Mckenzie');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Audra Mayo'),
  ('Clarke York'),
  ('Amos Cooley'),
  ('Beau Lowe'),
  ('Bernard Sears'),
  ('Hayfa Pratt'),
  ('Rowan Torres'),
  ('Olympia Roberson'),
  ('Alexandra Stout'),
  ('Aurora Cooke');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Charissa Booth'),
  ('Constance Mccormick'),
  ('Ryder Simon'),
  ('Elliott Hurst'),
  ('Yuri Cooper'),
  ('Elaine Thompson'),
  ('Freya Keller'),
  ('Maggy Mitchell'),
  ('Irma Moody'),
  ('Dillon Moran');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Hunter May'),
  ('Gil Tate'),
  ('Zelenia Cline'),
  ('Vanna Dorsey'),
  ('Tad Lynch'),
  ('Lane Weiss'),
  ('Samantha Brooks'),
  ('Regina Vasquez'),
  ('Josiah Roy'),
  ('Myles Holt');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Barclay Torres'),
  ('Kenneth Mcintyre'),
  ('Macy Valentine'),
  ('Yuri Vinson'),
  ('Cara Gallegos'),
  ('Xenos Cleveland'),
  ('Carol Brewer'),
  ('Pearl Foley'),
  ('Gavin Marsh'),
  ('Mollie Cash');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Burke Christensen'),
  ('Brock Riley'),
  ('Amir Byrd'),
  ('Garrison Giles'),
  ('Carlos Barber'),
  ('Peter Guy'),
  ('Marshall Charles'),
  ('Amaya Flynn'),
  ('Chantale Moran'),
  ('Leila Cummings');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Jaquelyn Ford'),
  ('Laith Rodriquez'),
  ('Abbot Bray'),
  ('Armand Dalton'),
  ('Patience Livingston'),
  ('Trevor Tran'),
  ('Brendan Whitley'),
  ('Declan Prince'),
  ('Rooney Bean'),
  ('Lane Navarro');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Imelda Burch'),
  ('Noel Fox'),
  ('Brynne Robles'),
  ('Kasimir Conway'),
  ('Karleigh Zamora'),
  ('Gavin Shelton'),
  ('Hadley Bond'),
  ('Keegan Deleon'),
  ('Judith Bridges'),
  ('Hayden Mccall');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Kirk Dean'),
  ('Rhiannon Nelson'),
  ('Kadeem Hester'),
  ('Hiroko Wilkinson'),
  ('Felix Gay'),
  ('Brendan Pearson'),
  ('Sigourney Murphy'),
  ('Jelani Mcintosh'),
  ('Thomas Doyle'),
  ('Holmes Petersen');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Darius Buckley'),
  ('Margaret Petty'),
  ('Beck Rodriguez'),
  ('Dane Mcgee'),
  ('Upton Hubbard'),
  ('Elizabeth Harper'),
  ('Thor Spence'),
  ('Francesca Francis'),
  ('Azalia Lawson'),
  ('Vincent Knowles');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Alisa Clay'),
  ('Remedios Andrews'),
  ('Alexa Harrell'),
  ('Valentine Knox'),
  ('Keely Sellers'),
  ('Shannon Rosario'),
  ('Alisa Cain'),
  ('Alexis Roach'),
  ('Uta O''donnell'),
  ('Brent Haney');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Lisandra Thompson'),
  ('Fuller Wilkerson'),
  ('Jelani Baldwin'),
  ('Denton Talley'),
  ('Madison Mcintosh'),
  ('Timon Franco'),
  ('Shelly Shaw'),
  ('Xandra Kelley'),
  ('Hamilton Bentley'),
  ('Dieter Black');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Chandler Mccarthy'),
  ('Wallace Farley'),
  ('Wade Pruitt'),
  ('Hashim Burns'),
  ('Fredericka Gonzales'),
  ('Stewart Mcgowan'),
  ('Tanner Wells'),
  ('Garth Gentry'),
  ('Slade Spencer'),
  ('Cameran O''connor');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Hadley Rosa'),
  ('Lacy Shields'),
  ('George Estes'),
  ('Macy Burton'),
  ('Dennis Brennan'),
  ('Jonah Head'),
  ('Linda Schneider'),
  ('Anne Bonner'),
  ('Denise Burton'),
  ('Tate Foreman');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Daquan Tanner'),
  ('Zorita Duffy'),
  ('Maxine Bass'),
  ('Quin Terrell'),
  ('Valentine King'),
  ('Ursa Vaughan'),
  ('Rahim Rios'),
  ('Griffin Whitehead'),
  ('Joan Lawson'),
  ('Cruz Prince');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO customers (name)
VALUES
  ('Brynn Roberts'),
  ('Acton Foley'),
  ('Fitzgerald Barron'),
  ('Thaddeus Austin'),
  ('Christen Woodward'),
  ('Walter Good'),
  ('Colin Hampton'),
  ('Chelsea Rojas'),
  ('Kirk Galloway'),
  ('Armand Mcguire');
;-- -. . -..- - / . -. - .-. -.--
DELETE * FROM goods;
;-- -. . -..- - / . -. - .-. -.--
SELECT DISTINCT idFROM goods;
;-- -. . -..- - / . -. - .-. -.--
SELECT DISTINCT id FROM goods;
;-- -. . -..- - / . -. - .-. -.--
SELECT COUNT(*) FROM (SELECT DISTINCT id FROM goods);
;-- -. . -..- - / . -. - .-. -.--
SELECT COUNT(*) FROM (SELECT DISTINCT id FROM goods) w;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM orders
JOIN sells s on orders.id = s.order_id
JOIN goods g on s.good_id = g.id;
;-- -. . -..- - / . -. - .-. -.--
SELECT s.amount*g.cost FROM orders
JOIN sells s on orders.id = s.order_id
JOIN goods g on s.good_id = g.id;
;-- -. . -..- - / . -. - .-. -.--
SELECT s.amount,g.cost,s.amount*g.cost as total FROM orders
JOIN sells s on orders.id = s.order_id
JOIN goods g on s.good_id = g.id;
;-- -. . -..- - / . -. - .-. -.--
SELECT s.amount, g.cost, s.amount * g.cost as total
FROM orders
         JOIN sells s on orders.id = s.order_id
         JOIN goods g on s.good_id = g.id
LIMIT 100;
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE IF NOT EXISTS orders
(
    id          SERIAL PRIMARY KEY,
    customer_id INT,
    total_cost  FLOAT,
    is_finished BOOLEAN,
    time        TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers (id) ON DELETE CASCADE
);
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION on_new_sell_trigger()
    RETURNS TRIGGER
    LANGUAGE plpgsql AS
$func$
BEGIN
    UPDATE orders
    SET total_cost = (SELECT cost * NEW.amount FROM goods WHERE id = NEW.good_id)
    -- может быть += , а не =
    WHERE orders.id = NEW.order_id;
    return NEW;
END
$func$;
;-- -. . -..- - / . -. - .-. -.--
SELECT cost * 3 FROM goods WHERE id = 1;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM orders WHERE id = 1;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM sells
         JOIN goods g on g.id = sells.good_id;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM sells
         JOIN goods g on g.id = sells.good_id
WHERE order_id = 1;
;-- -. . -..- - / . -. - .-. -.--
SELECT amount, cost
FROM sells
         JOIN goods g on g.id = sells.good_id
WHERE order_id = 1;
;-- -. . -..- - / . -. - .-. -.--
SELECT amount, cost, amount*cost AS total
FROM sells
         JOIN goods g on g.id = sells.good_id
WHERE order_id = 1;
;-- -. . -..- - / . -. - .-. -.--
SELECT SUM(amount*cost)
FROM sells
         JOIN goods g on g.id = sells.good_id
WHERE order_id = 1
GROUP BY order_id;
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE IF NOT EXISTS sellers
(
    id   SERIAL PRIMARY KEY,
    name VARCHAR(60)
);
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE IF NOT EXISTS goods
(
    id          SERIAL PRIMARY KEY,
    seller_id   INT,
    description VARCHAR(100),
    cost        FLOAT,
    FOREIGN KEY (seller_id) REFERENCES sellers (id) ON DELETE CASCADE
);
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE IF NOT EXISTS customers
(
    id   SERIAL PRIMARY KEY,
    name VARCHAR(60)
);
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE IF NOT EXISTS orders
(
    id          SERIAL PRIMARY KEY,
    customer_id INT,
    total_cost  FLOAT DEFAULT 0,
    is_finished BOOLEAN,
    time        TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers (id) ON DELETE CASCADE
);
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE IF NOT EXISTS sells
(
    id       SERIAL PRIMARY KEY,
    order_id INT,
    good_id  INT,
    amount   INT,
    FOREIGN KEY (order_id) REFERENCES orders (id) ON DELETE CASCADE,
    FOREIGN KEY (good_id) REFERENCES goods (id) ON DELETE CASCADE
);
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION on_new_sell_trigger()
    RETURNS TRIGGER
    LANGUAGE plpgsql AS
$func$
BEGIN
    UPDATE orders
    SET total_cost = (SELECT SUM(amount * cost)
                      FROM sells
                               JOIN goods g on g.id = sells.good_id
                      WHERE order_id = NEW.order_id
                      GROUP BY order_id)
    WHERE orders.id = NEW.order_id;
    return NEW;
END
$func$;
;-- -. . -..- - / . -. - .-. -.--
DROP TRIGGER IF EXISTS on_new_sell_trigger ON sells;
;-- -. . -..- - / . -. - .-. -.--
CREATE TRIGGER on_new_sell_trigger
    AFTER INSERT OR UPDATE
    ON sells
    FOR EACH ROW
EXECUTE PROCEDURE on_new_sell_trigger();
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM orders WHERE time BETWEEN '2010-01-01' AND '2014-01-01';
;-- -. . -..- - / . -. - .-. -.--
customer_id==10;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM orders WHERE (time BETWEEN '2010-01-01' AND '2014-01-01') AND (customer_id==10);
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM orders WHERE (time BETWEEN '2010-01-01' AND '2014-01-01') AND (customer_id=10);
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM orders
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND (customer_id = 10)
ORDER BY time;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM orders
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND (customer_id = 10)
ORDER BY time DESC, total_cost DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM orders
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND (customer_id = 10)
ORDER BY total_cost DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM orders
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND (customer_id = 10)
ORDER BY total_cost DESC, time DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM orders
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND (customer_id = 10)
ORDER BY time DESC;
;-- -. . -..- - / . -. - .-. -.--
-- статистика покупок за выбронный период по определенному клиенту
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost FLOAT,
                time TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE SQL
AS
$$
SELECT *
FROM orders
WHERE (time BETWEEN $2 AND $3)
  AND (customer_id = $1)
ORDER BY time DESC
$$;
;-- -. . -..- - / . -. - .-. -.--
-- статистика покупок за выбронный период по определенному клиенту
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost FLOAT,
                time TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE SQL
AS
$$
SELECT total_cost, time, is_finished
FROM orders
WHERE (time BETWEEN $2 AND $3)
  AND (customer_id = $1)
ORDER BY time DESC;
$$;
;-- -. . -..- - / . -. - .-. -.--
-- статистика покупок за выбронный период по определенному клиенту
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost FLOAT,
                order_tim TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE SQL
AS
$$
SELECT total_cost, time, is_finished
FROM orders
WHERE (time BETWEEN $2 AND $3)
  AND (customer_id = $1)
ORDER BY time DESC;
$$;
;-- -. . -..- - / . -. - .-. -.--
-- статистика покупок за выбронный период по определенному клиенту
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost FLOAT,
                order TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE SQL
AS
$$
SELECT total_cost, time, is_finished
FROM orders
WHERE (time BETWEEN $2 AND $3)
  AND (customer_id = $1)
ORDER BY time DESC;
$$;
;-- -. . -..- - / . -. - .-. -.--
-- статистика покупок за выбронный период по определенному клиенту
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost FLOAT,
                order_time TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE SQL
AS
$$
SELECT total_cost, time, is_finished
FROM orders
WHERE (time BETWEEN $2 AND $3)
  AND (customer_id = $1)
ORDER BY time DESC;
$$;
;-- -. . -..- - / . -. - .-. -.--
DROP FUNCTION customer_stat(integer,timestamp without time zone,timestamp without time zone);
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost FLOAT,
                order_time TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE SQL
AS
$$
SELECT total_cost, time, is_finished
FROM orders
WHERE (time BETWEEN $2 AND $3)
  AND (customer_id = $1)
ORDER BY time DESC;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
AS
$$
BEGIN
    RETURN QUERY SELECT total_cost, time, is_finished
                 FROM orders
                 WHERE (time BETWEEN $2 AND $3)
                   AND (customer_id = $1)
                 ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
DROP FUNCTION customer_stat(integer, timestamp without time zone, timestamp without time zone);
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY SELECT total_cost, time, is_finished
                 FROM orders
                 WHERE (time BETWEEN $2 AND $3)
                   AND (customer_id = $1)
                 ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN TABLE SELECT total_cost, time, is_finished
                 FROM orders
                 WHERE (time BETWEEN $2 AND $3)
                   AND (customer_id = $1)
                 ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN SELECT total_cost, time, is_finished
                 FROM orders
                 WHERE (time BETWEEN $2 AND $3)
                   AND (customer_id = $1)
                 ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(INT, TIMESTAMP, TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
    BEGIN
        SELECT total_cost, time, is_finished
        FROM orders
        WHERE (time BETWEEN $2 AND $3)
          AND (customer_id = $1)
        ORDER BY time DESC;
    END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
    BEGIN
        SELECT total_cost, time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
    END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
    BEGIN
        RETURN QUERY SELECT total_cost, time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
    END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
    BEGIN
        RETURN QUERY SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
    END;
$$;
;-- -. . -..- - / . -. - .-. -.--
SELECT customer_stat(10, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE sql
AS $$
    BEGIN
        RETURN QUERY SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END; $$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE sql
AS $$
    BEGIN
         SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END; $$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE sql
AS $$
    BEGIN
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END; $$;
;-- -. . -..- - / . -. - .-. -.--
SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                order_time  TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS $$
    BEGIN
        RETURN QUERY SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END; $$;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM customer_stat(10, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total_cost  FLOAT,
                time TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS $$
    BEGIN
        RETURN QUERY SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END; $$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total FLOAT,
                t TIMESTAMP,
                f BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total FLOAT,
                time TIMESTAMP,
                f BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total FLOAT,
                order_time TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total FLOAT,
                order_time TIMESTAMP,
                is_finished BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished as f
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total FLOAT,
                order_time TIMESTAMP,
                is BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total FLOAT,
                order_time TIMESTAMP,
                finish_status BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
orders;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total         FLOAT,
                order_time    TIMESTAMP,
                finish_status BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total         FLOAT,
                order_time    TIMESTAMP,
                finish_status BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description FROM goods WHERE seller_id=p_id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                description VARCHAR
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description FROM goods WHERE seller_id=p_id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description FROM goods WHERE seller_id=p_id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
RETURN QUERY
        SELECT description FROM goods JOIN sells ON sells.good_id = goods.id  WHERE seller_id = p_id;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT DISTINCT description
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
        WHERE seller_id = p_id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
SELECT COUNT(*)
FROM seller_stat(10, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
        WHERE seller_id = p_id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, cost
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT,
                items_selled INT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, cost, COUNT(*)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT,
                items_selled INT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, AVG(cost), COUNT(*)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT,
                items_selled INT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, AVG(cost), COUNT(*)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY goods.id, description;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT,
                items_selled INT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, AVG(cost), COUNT(*)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY description;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT,
                items_selled INT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, AVG(cost) as costa, COUNT(*) AS selled_c
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY description;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost BIGINT,
                items_selled INT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, AVG(cost) as costa, COUNT(*) AS selled_c
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY description;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT,
                items_selled BIGINT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, AVG(cost) as costa, COUNT(*) AS selled_c
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY description;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT,
                items_selled BIGINT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(*) AS selled_c
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                item_cost FLOAT,
                items_selled INT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(*) AS selled_c
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end) AND seller_id = p_id
    GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(*) AS selled_c
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT,
                total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, ROUND(cost, 2), COUNT(*), SUM(cost*amount)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT,
                total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, ROUND(cost), COUNT(*), SUM(cost*amount)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
cost;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT,
                total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(*), SUM(cost*amount)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT,
                total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(*), cost*amount
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT,
                total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(*), goods.cost*sells.amount
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT,
                total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(*), SUM(goods.cost*sells.amount)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT,
                total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, 1,2
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--

--                 total_cost        FLOAT;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
--                 items_selled     BIGINT,
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT
--                 items_selled     BIGINT,
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY goods.id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT
--                 items_selled     BIGINT,
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT
--                 items_selled     BIGINT,
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id AND goods.id = 100;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT
--                 items_selled     BIGINT,
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id AND goods.id > 1000;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT
--                 items_selled     BIGINT,
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id AND goods.id > 30508;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT
--                 items_selled     BIGINT,
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id AND goods.id = 30508;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT
                items_selled     BIGINT,
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(goods.id)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id GROUP BY goods.id, cost
    ;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT
                items_selled     BIGINT
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(goods.id)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id GROUP BY goods.id, cost;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT
--                 total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(goods.id)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id GROUP BY goods.id, cost;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                id INT,
                -- FIXME (см fixme) в теле функции
--                 good_description VARCHAR,
                item_cost        FLOAT,
                items_selled     BIGINT,
                total_cost        FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        -- FIXME убрать дубликаты description, чтобы выводить его тоже
        SELECT goods.id, cost, COUNT(goods.id), SUM(cost*sells.amount)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id GROUP BY goods.id, cost;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
With CTE(Duplicates,item,concat)
as
(
SELECT ROW_NUMBER() OVER(PARTITION by description,seller_id, cost ORDER BY description )
AS duplicates,seller_id, goods.description+''+goods.seller_id
FROM goods
)
--Now Delete Duplicate Records
select * FROM CTE
WHERE duplicates > 1;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM goods GROUP BY description;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, COUNT(*) FROM goods GROUP BY description;
;-- -. . -..- - / . -. - .-. -.--
SELECT COUNT(*) FROM sells;
;-- -. . -..- - / . -. - .-. -.--
SELECT COUNT(*) FROM goods;
;-- -. . -..- - / . -. - .-. -.--
SELECT COUNT(*) FROM sellers;
;-- -. . -..- - / . -. - .-. -.--
SELECT COUNT(*) FROM orders;
;-- -. . -..- - / . -. - .-. -.--
SELECT COUNT(*) FROM customers;
;-- -. . -..- - / . -. - .-. -.--
XISTS sells;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS goods;
DROP TABLE IF EXISTS sellers;
DROP TABLE IF EXISTS customers;;
;-- -. . -..- - / . -. - .-. -.--
DROP TABLE IF EXISTS sells;
;-- -. . -..- - / . -. - .-. -.--
DROP TABLE IF EXISTS orders;
;-- -. . -..- - / . -. - .-. -.--
DROP TABLE IF EXISTS goods;
;-- -. . -..- - / . -. - .-. -.--
DROP TABLE IF EXISTS sellers;
;-- -. . -..- - / . -. - .-. -.--
DROP TABLE IF EXISTS customers;
;-- -. . -..- - / . -. - .-. -.--
SELECT goods.id, cost, COUNT(goods.id), SUM(cost*sells.amount)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
          AND seller_id = 10 GROUP BY goods.id, cost;
;-- -. . -..- - / . -. - .-. -.--
SELECT goods.id, cost, COUNT(goods.id), SUM(cost*sells.amount)
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id;
;-- -. . -..- - / . -. - .-. -.--
SELECT goods.description
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, amount, cost, amount*cost
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, amount, cost, amount*cost as total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT DISTINCT description, amount, cost, amount*cost AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, amount, cost, amount*cost AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, SUM(amount), SUM(cost), SUM(cost)*SUM(amount) AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10
GROUP BY description;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, SUM(amount), SUM(cost), SUM(cost)*SUM(amount) AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10
GROUP BY description
ORDER BY SUM(cost)*SUM(amount) DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, SUM(amount), SUM(cost), SUM(cost)*SUM(amount) AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10
GROUP BY description
ORDER BY total DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, SUM(amount) as total_amount, cost, SUM(cost)*SUM(amount) AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10
GROUP BY description, cost
ORDER BY total DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, SUM(amount) as total_amount, cost, cost*total_amount AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10
GROUP BY description, cost
ORDER BY total DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, SUM(amount) as total_amount, cost, cost*SUM(amount) AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10
GROUP BY description, cost
ORDER BY total DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, SUM(amount) as total_amount, cost, round(cost*SUM(amount),2) AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10
GROUP BY description, cost
ORDER BY total DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT description, SUM(amount) as total_amount, cost, ROUND(cost*SUM(amount)) AS total
FROM goods
         JOIN sells ON sells.good_id = goods.id
         JOIN orders on orders.id = sells.order_id
WHERE (time BETWEEN '2010-01-01' AND '2014-01-01')
  AND seller_id = 10
GROUP BY description, cost
ORDER BY total DESC;
;-- -. . -..- - / . -. - .-. -.--
DROP FUNCTION IF EXISTS customer_stat(integer, timestamp without time zone, timestamp without time zone);
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total         FLOAT,
                order_time    TIMESTAMP,
                finish_status BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT total_cost, time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
DROP FUNCTION IF EXISTS seller_stat(integer, timestamp without time zone, timestamp without time zone);
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION seller_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                good_description VARCHAR,
                items_selled BIGINT,
                single_cost   FLOAT,
                total_cost   FLOAT
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT description, SUM(amount) as total_amount, cost, ROUND(cost * SUM(amount)) AS total
        FROM goods
                 JOIN sells ON sells.good_id = goods.id
                 JOIN orders on orders.id = sells.order_id
        WHERE (time BETWEEN p_start AND p_end)
          AND seller_id = p_id
        GROUP BY description, cost
        ORDER BY total DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM customer_stat(10, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM customer_stat(11, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM customer_stat(133, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM customer_stat(15, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
SELECT DISTINCT customer_id FROM orders;
;-- -. . -..- - / . -. - .-. -.--
RETURN QUERY
        SELECT ROUND(total_cost), time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY total_cost DESC;
;-- -. . -..- - / . -. - .-. -.--
RETURN QUERY
        SELECT ROUND(total_cost), time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY ROUND(total_cost) DESC;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total         FLOAT,
                order_time    TIMESTAMP,
                finish_status BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT ROUND(total_cost), time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY ROUND(total_cost) DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION customer_stat(p_id INT, p_start TIMESTAMP, p_end TIMESTAMP)
    RETURNS TABLE
            (
                total         FLOAT,
                order_time    TIMESTAMP,
                finish_status BOOLEAN
            )
    LANGUAGE plpgsql
AS
$$
BEGIN
    RETURN QUERY
        SELECT ROUND(total_cost), time as order_time, is_finished
        FROM orders
        WHERE (time BETWEEN p_start AND p_end)
          AND (customer_id = p_id)
        ORDER BY time DESC;
END;
$$;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM customer_stat(4979, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM goods;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM goods JOIN sells on goods.id = sells.good_id LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM sells;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, SUM(amount) FROM sells
GROUP BY good_id;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, SUM(amount) AS selled_amount FROM sells
GROUP BY good_id
ORDER BY selled_amount;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, SUM(amount) AS selled_amount FROM sells
GROUP BY good_id
ORDER BY selled_amount DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, SUM(amount) AS selled_amount FROM sells
GROUP BY good_id
HAVING SUM(amount) > 100
ORDER BY selled_amount DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, SUM(amount) AS selled_amount FROM sells
GROUP BY good_id
HAVING SUM(amount) > 100
ORDER BY selled_amount DESC
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, SUM(amount) AS selled_amount
FROM sells
GROUP BY good_id
HAVING SUM(amount) < 100
ORDER BY selled_amount DESC
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, SUM(amount) AS selled_amount
FROM sells JOIN goods ON goods.id = sells.good_id
GROUP BY good_id
HAVING SUM(amount) > 100
ORDER BY selled_amount DESC
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, description, SUM(amount) AS selled_amount
FROM sells
         JOIN goods ON goods.id = sells.good_id
GROUP BY good_id, description
HAVING SUM(amount) > 100
ORDER BY selled_amount DESC
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT good_id, description, cost, SUM(amount) AS selled_amount
FROM sells
         JOIN goods ON goods.id = sells.good_id
GROUP BY good_id, description, cost
HAVING SUM(amount) > 100
ORDER BY selled_amount DESC
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
CREATE VIEW goods_top AS
SELECT good_id, description, cost, SUM(amount) AS selled_amount
FROM sells
         JOIN goods ON goods.id = sells.good_id
GROUP BY good_id, description, cost
HAVING SUM(amount) > 100
ORDER BY selled_amount DESC
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE VIEW goods_top AS
SELECT good_id, description, cost, SUM(amount) AS selled_amount
FROM sells
         JOIN goods ON goods.id = sells.good_id
GROUP BY good_id, description, cost
HAVING SUM(amount) > 30
ORDER BY selled_amount DESC
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE VIEW goods_top AS
SELECT good_id, description, cost, SUM(amount) AS selled_amount
FROM sells
         JOIN goods ON goods.id = sells.good_id
GROUP BY good_id, description, cost
HAVING SUM(amount) > 30
ORDER BY selled_amount DESC
LIMIT 100;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM sellers
JOIN goods g on sellers.id = g.seller_id
JOIN sells s on g.id = s.good_id LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT sellers.id, sellers.name, amount FROM sellers
JOIN goods g on sellers.id = g.seller_id
JOIN sells s on g.id = s.good_id LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT sellers.id, sellers.name, SUM(amount)
FROM sellers
         JOIN goods g on sellers.id = g.seller_id
         JOIN sells s on g.id = s.good_id
GROUP BY sellers.id, sellers.name
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
SELECT sellers.id, sellers.name, SUM(amount) as goods_selled
FROM sellers
         JOIN goods g on sellers.id = g.seller_id
         JOIN sells s on g.id = s.good_id
GROUP BY sellers.id, sellers.name
ORDER BY goods_selled DESC
LIMIT 10;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE VIEW goods_top AS
SELECT good_id, description, cost, SUM(amount) AS selled_amount
FROM sells
         JOIN goods ON goods.id = sells.good_id
GROUP BY good_id, description, cost
ORDER BY selled_amount DESC
LIMIT 100;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE VIEW sellers_top AS
SELECT sellers.id, sellers.name, SUM(amount) as goods_selled
FROM sellers
         JOIN goods g on sellers.id = g.seller_id
         JOIN sells s on g.id = s.good_id
GROUP BY sellers.id, sellers.name
ORDER BY goods_selled DESC
LIMIT 100;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM customers
JOIN orders o on customers.id = o.customer_id
JOIN sells s on o.id = s.order_id;
;-- -. . -..- - / . -. - .-. -.--
SELECT customers.id, customers.name, SUM(total_cost) FROM customers
JOIN orders o on customers.id = o.customer_id
JOIN sells s on o.id = s.order_id
GROUP BY customers.id, customers.name;
;-- -. . -..- - / . -. - .-. -.--
SELECT customers.id, customers.name, ROUND(SUM(total_cost)) AS spent_money
FROM customers
         JOIN orders o on customers.id = o.customer_id
         JOIN sells s on o.id = s.order_id
GROUP BY customers.id, customers.name;
;-- -. . -..- - / . -. - .-. -.--
DROP VIEW IF EXISTS goods_top;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE VIEW goods_top AS
SELECT good_id, description, cost, SUM(amount) AS selled_amount
FROM sells
         JOIN goods ON goods.id = sells.good_id
GROUP BY good_id, description, cost
ORDER BY selled_amount DESC;
;-- -. . -..- - / . -. - .-. -.--
DROP VIEW IF EXISTS sellers_top;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE VIEW sellers_top AS
SELECT sellers.id, sellers.name, SUM(amount*cost) as goods_selled
FROM sellers
         JOIN goods g on sellers.id = g.seller_id
         JOIN sells s on g.id = s.good_id
GROUP BY sellers.id, sellers.name
ORDER BY goods_selled DESC;
;-- -. . -..- - / . -. - .-. -.--
DROP VIEW IF EXISTS customers_top;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE VIEW customers_top AS
SELECT customers.id, customers.name, ROUND(SUM(total_cost)) AS total_spent
FROM customers
         JOIN orders o on customers.id = o.customer_id
         JOIN sells s on o.id = s.order_id
GROUP BY customers.id, customers.name
ORDER BY total_spent DESC;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM customers_top;
;-- -. . -..- - / . -. - .-. -.--
SELECT customers.id, customers.name, ROUND(SUM(total_cost)) AS total_spent
FROM customers
         JOIN orders o on customers.id = o.customer_id
         JOIN sells s on o.id = s.order_id
GROUP BY customers.id, customers.name
ORDER BY total_spent DESC;
;-- -. . -..- - / . -. - .-. -.--
EXPLAIN ANALYZE SELECT customers.id, customers.name, ROUND(SUM(total_cost)) AS total_spent
FROM customers
         JOIN orders o on customers.id = o.customer_id
         JOIN sells s on o.id = s.order_id
GROUP BY customers.id, customers.name
ORDER BY total_spent DESC;
;-- -. . -..- - / . -. - .-. -.--
DROP INDEX customers_index;
;-- -. . -..- - / . -. - .-. -.--
CREATE INDEX customers_index ON customers(id, name);
;-- -. . -..- - / . -. - .-. -.--
SELECT customer_id, COUNT(*) FROM orders GROUP BY customer_id;
;-- -. . -..- - / . -. - .-. -.--
EXPLAIN ANALYZE SELECT customer_id, COUNT(*) FROM orders GROUP BY customer_id;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM seller_stat(10, '2010-01-01', '2014-01-01');
;-- -. . -..- - / . -. - .-. -.--
SELECT id FROM test WHERE id=3;
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM test WHERE name='andrey';
;-- -. . -..- - / . -. - .-. -.--
DROP INDEX idx_name;
;-- -. . -..- - / . -. - .-. -.--
SELECT name FROM test WHERE name='andrey';
;-- -. . -..- - / . -. - .-. -.--
CREATE INDEX idx_name ON test(name);
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE IF NOT EXISTS test(
    id SERIAL PRIMARY KEY,
    name VARCHAR(50)
);
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO public.test (id, name)
VALUES (1, 'andrey');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO public.test (id, name)
VALUES (2, 'senya');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO public.test (id, name)
VALUES (3, 'den');
;-- -. . -..- - / . -. - .-. -.--
INSERT INTO public.test (id, name)
VALUES (4, 'anton');
;-- -. . -..- - / . -. - .-. -.--
EXPLAIN ANALYZE SELECT name FROM test WHERE name='andrey';
;-- -. . -..- - / . -. - .-. -.--
DROP TABLE IF EXISTS test;
;-- -. . -..- - / . -. - .-. -.--
CREATE TABLE Участники
(
    Участник TEXT NOT NULL PRIMARY KEY
);
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE VIEW test_view AS
SELECT * FROM Участники WHERE Участник LIKE 'Б%';
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM "Конкурсы";
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM "Баллы";
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM "Баллы" WHERE "Конкурс"='' ||
                                      'IT-разработка';
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM "Баллы" WHERE "Конкурс"='IT-' ||
                                      '' ||
                                      '' ||
                                      '' ||
                                      'разработка';
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM "Баллы" WHERE "Конкурс"='IT-разработка';
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM "Баллы" WHERE "Конкурс"='IT-разработка' ORDER BY "Количество_баллов";
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM "Баллы" WHERE "Конкурс"='IT-разработка' ORDER BY "Количество_баллов" DESC;
;-- -. . -..- - / . -. - .-. -.--
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Факультет)
SELECT Факультет, count(ПервыйФак) *3 + count(ВторойФак) *2 + count(ТретийФак) AS Рейтинг
FROM МестаФакультетов
GROUP BY Факультет;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION РезультатыКонкурсов()
    RETURNS TABLE
            (
                Факультет    TEXT,
                Первых_мест  TEXT,
                Вторых_мест  TEXT,
                Третьих_мест TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Факультет)
SELECT Факультет, ПервыйФак, ВторойФак, ТретийФак
FROM МестаФакультетов;
$$;
;-- -. . -..- - / . -. - .-. -.--
SELECT РезультатыКонкурсов();
;-- -. . -..- - / . -. - .-. -.--
SELECT * FROM РезультатыКонкурсов();
;-- -. . -..- - / . -. - .-. -.--
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Факультет)
SELECT Факультет, SUM(ПервыйФак), MAX(ВторойФак), MAX(ТретийФак)
FROM МестаФакультетов
GROUP BY МестаФакультетов.Факультет;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION РезультатыКонкурсов()
    RETURNS TABLE
            (
                Факультет    TEXT,
                Первых_мест  TEXT,
                Вторых_мест  TEXT,
                Третьих_мест TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Факультет)
SELECT Факультет, MAX(ПервыйФак), MAX(ВторойФак), MAX(ТретийФак)
FROM МестаФакультетов
GROUP BY МестаФакультетов.Факультет;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION РезультатыКонкурсов()
    RETURNS TABLE
            (
                Факультет    TEXT,
                Первых_мест  TEXT,
                Вторых_мест  TEXT,
                Третьих_мест TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Факультет)
SELECT Факультет, MAX(ПервыйФак), MAX(ВторойФак), MAX(ТретийФак)
FROM МестаФакультетов
GROUP BY Факультет;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION РезультатыКонкурсов()
    RETURNS TABLE
            (
                Факультет    TEXT,
                ПервоеМесто  TEXT,
                ВтороеМесто  TEXT,
                ТретьеМесто TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Факультет)
SELECT Факультет, MAX(Первых_мест), MAX(Первых_мест), MAX(Первых_мест)
FROM МестаФакультетов
GROUP BY Факультет;
$$;
;-- -. . -..- - / . -. - .-. -.--
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Конкурс,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Конкурс)
SELECT Конкурс, MAX(ПервыйФак) AS Первое_Место, MAX(ВторойФак) AS Второе_Место, MAX(ТретийФак) AS Третье_Место
FROM МестаФакультетов
GROUP BY Конкурс;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION РезультатыКонкурсов()
    RETURNS TABLE
            (
                Факультет    TEXT,
                ПервоеМесто  TEXT,
                ВтороеМесто  TEXT,
                ТретьеМесто TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Конкурс,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Конкурс)
SELECT Конкурс, MAX(ПервыйФак) AS Первое_Место, MAX(ВторойФак) AS Второе_Место, MAX(ТретийФак) AS Третье_Место
FROM МестаФакультетов
GROUP BY Конкурс;
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION РезультатыКонкурсов()
    RETURNS TABLE
            (
                Факультет   TEXT,
                ПервоеМесто TEXT,
                ВтороеМесто TEXT,
                ТретьеМесто TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Конкурс,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Конкурс)
SELECT Конкурс, ПервыйФак, ВторойФак, ТретийФак
FROM МестаФакультетов
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION РезультатыКонкурсов()
    RETURNS TABLE
            (
                Конкурс   TEXT,
                ПервыйФак TEXT,
                ВторойФак TEXT,
                ТретийФак TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Конкурс,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Конкурс)
SELECT Конкурс, ПервыйФак, ВторойФак, ТретийФак
FROM МестаФакультетов
$$;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM РезультатыКонкурсов();
;-- -. . -..- - / . -. - .-. -.--
SELECT Конкурс, MAX(ПервыйФак) AS ПервоеМесто, MAX(ВторойФак) AS ВтороеМесто, MAX(ТретийФак) AS ТретьеМесто
FROM РезультатыКонкурсов()
GROUP BY Конкурс;
;-- -. . -..- - / . -. - .-. -.--
DROP FUNCTION IF EXISTS РезультатыКонкурсов;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION МестаФакультетовБезГруппировки()
    RETURNS TABLE
            (
                Конкурс   TEXT,
                ПервыйФак TEXT,
                ВторойФак TEXT,
                ТретийФак TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Конкурс,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Конкурс)
SELECT Конкурс, ПервыйФак, ВторойФак, ТретийФак
FROM МестаФакультетов
$$;
;-- -. . -..- - / . -. - .-. -.--
SELECT *
FROM МестаФакультетовБезГруппировки();
;-- -. . -..- - / . -. - .-. -.--
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Факультет)
SELECT Факультет, count(ПервыйФак) * 3 + count(ВторойФак) * 2 + count(ТретийФак) AS Рейтинг
FROM МестаФакультетов
GROUP BY Факультет;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION МестаФакультетовБезГруппировки()
    RETURNS TABLE
            (
                Конкурс   TEXT,
                Факультет TEXT,
                ПервыйФак TEXT,
                ВторойФак TEXT,
                ТретийФак TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Конкурс,
                                 ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Конкурс)
SELECT Конкурс, Факультет, ПервыйФак, ВторойФак, ТретийФак
FROM МестаФакультетов
$$;
;-- -. . -..- - / . -. - .-. -.--
SELECT Конкурс, MAX(ПервыйФак) AS ПервоеМесто, MAX(ВторойФак) AS ВтороеМесто, MAX(ТретийФак) AS ТретьеМесто
FROM МестаФакультетовБезГруппировки()
GROUP BY Конкурс;
;-- -. . -..- - / . -. - .-. -.--
SELECT Факультет, count(ПервыйФак) * 3 + count(ВторойФак) * 2 + count(ТретийФак) AS Рейтинг
FROM МестаФакультетовБезГруппировки()
GROUP BY Факультет;
;-- -. . -..- - / . -. - .-. -.--
DROP FUNCTION IF EXISTS МестаФакультетовБезГруппировки;
;-- -. . -..- - / . -. - .-. -.--
CREATE OR REPLACE FUNCTION КонкурсыИМестаФакультетовБезГруппировки()
    RETURNS TABLE
            (
                Конкурс   TEXT,
                Факультет TEXT,
                ПервыйФак TEXT,
                ВторойФак TEXT,
                ТретийФак TEXT
            )
    LANGUAGE SQL
AS
$$
WITH ВсеБаллы AS (SELECT Конкурс, Количество_баллов, Факультет
                  FROM Участник_Факультет
                           JOIN Баллы ON Участник_Факультет.Участник = Баллы.Участник
                  ORDER BY Конкурс, Количество_баллов DESC),
     БаллыПервыхМест AS (SELECT Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                         GROUP BY Конкурс
                         ORDER BY Конкурс),
     БаллыВторыхМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                         FROM ВсеБаллы
                                  LEFT JOIN БаллыПервыхМест
                                            ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                               БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                         WHERE МаксБалл IS NULL
                         GROUP BY ВсеБаллы.Конкурс
                         ORDER BY Конкурс),
     БаллыТретьихМест AS (SELECT ВсеБаллы.Конкурс, MAX(Количество_баллов) AS МаксБалл
                          FROM ВсеБаллы
                                   LEFT JOIN БаллыПервыхМест
                                             ON БаллыПервыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыПервыхМест.Конкурс = ВсеБаллы.Конкурс
                                   LEFT JOIN БаллыВторыхМест
                                             ON БаллыВторыхМест.МаксБалл = ВсеБаллы.Количество_баллов AND
                                                БаллыВторыхМест.Конкурс = ВсеБаллы.Конкурс
                          WHERE БаллыПервыхМест.МаксБалл IS NULL
                            AND БаллыВторыхМест.МаксБалл IS NULL
                          GROUP BY ВсеБаллы.Конкурс
                          ORDER BY Конкурс),
     БаллыВсехМест AS (SELECT ВсеБаллы.Конкурс,
                              ВсеБаллы.Факультет,
                              БаллыПервыхМест.МаксБалл  AS БаллПервого,
                              БаллыВторыхМест.МаксБалл  AS БаллВторого,
                              БаллыТретьихМест.МаксБалл AS БаллТретьего
                       FROM ВсеБаллы
                                FULL JOIN БаллыПервыхМест
                                          ON ВсеБаллы.Конкурс = БаллыПервыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыПервыхМест.МаксБалл
                                FULL JOIN БаллыВторыхМест
                                          ON ВсеБаллы.Конкурс = БаллыВторыхМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыВторыхМест.МаксБалл
                                FULL JOIN БаллыТретьихМест
                                          ON ВсеБаллы.Конкурс = БаллыТретьихМест.Конкурс AND
                                             ВсеБаллы.Количество_баллов = БаллыТретьихМест.МаксБалл
                       WHERE (БаллыПервыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыВторыхМест.МаксБалл IS NOT NULL)
                          OR (БаллыТретьихМест.МаксБалл IS NOT NULL)
                       ORDER BY ВсеБаллы.Конкурс),
     МестаФакультетов AS (SELECT ВсеБаллы.Конкурс,
                                 ВсеБаллы.Факультет,
                                 at1.Факультет AS ПервыйФак,
                                 at2.Факультет AS ВторойФак,
                                 at3.Факультет AS ТретийФак
                          FROM ВсеБаллы
                                   FULL JOIN БаллыВсехМест at1 ON ВсеБаллы.Факультет = at1.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at1.БаллПервого
                                   FULL JOIN БаллыВсехМест at2 ON ВсеБаллы.Факультет = at2.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at2.БаллВторого
                                   FULL JOIN БаллыВсехМест at3 ON ВсеБаллы.Факультет = at3.Факультет and
                                                                  ВсеБаллы.Количество_баллов = at3.БаллТретьего
                          WHERE ((at1.Факультет IS NOT NULL)
                              OR (at2.Факультет IS NOT NULL)
                              OR (at3.Факультет IS NOT NULL))
                            AND ВсеБаллы.Конкурс IS NOT NULL
                          ORDER BY ВсеБаллы.Конкурс)
SELECT Конкурс, Факультет, ПервыйФак, ВторойФак, ТретийФак
FROM МестаФакультетов
$$;
;-- -. . -..- - / . -. - .-. -.--
CREATE FUNCTION инсерт() RETURNS TRIGGER
    LANGUAGE plpgsql
AS
$func$
BEGIN
    TRUNCATE Победители_и_призеры;
    INSERT INTO Победители_и_призеры
    SELECT Конкурс, MAX(ПервыйФак) AS ПервоеМесто, MAX(ВторойФак) AS ВтороеМесто, MAX(ТретийФак) AS ТретьеМесто
    FROM КонкурсыИМестаФакультетовБезГруппировки()
    GROUP BY Конкурс;
    RETURN new;
END;
$func$;
;-- -. . -..- - / . -. - .-. -.--
CREATE TRIGGER Баллы
    AFTER UPDATE OR INSERT
    ON Баллы
    FOR EACH ROW
EXECUTE PROCEDURE инсерт();
;-- -. . -..- - / . -. - .-. -.--
DROP TRIGGER IF EXISTS Баллы ON Баллы;
;-- -. . -..- - / . -. - .-. -.--
SELECT Конкурс, MAX(ПервыйФак) AS ПервоеМесто, MAX(ВторойФак) AS ВтороеМесто, MAX(ТретийФак) AS ТретьеМесто
FROM КонкурсыИМестаФакультетовБезГруппировки()
GROUP BY Конкурс;
;-- -. . -..- - / . -. - .-. -.--
SELECT Факультет, count(ПервыйФак) * 3 + count(ВторойФак) * 2 + count(ТретийФак) AS Рейтинг
FROM КонкурсыИМестаФакультетовБезГруппировки()
GROUP BY Факультет;